<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EVE å·¥å…·é›†</title>
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css', v='1.0') }}">
    <style>
        /* ä¸‹æ‹‰èœå•æ ·å¼ */
        #dropdown-menu {
            display: none;
            position: fixed;
            background-color: white;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 9999;
            border-radius: 4px;
            overflow: hidden;
        }
        
        #dropdown-menu a {
            color: #333;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }
        
        #dropdown-menu a:hover {
            background-color: #f1f1f1;
            color: #1976d2;
        }
        
        /* å¤œé—´æ¨¡å¼æ ·å¼ */
        [data-theme="dark"] #dropdown-menu {
            background-color: #333;
        }
        
        [data-theme="dark"] #dropdown-menu a {
            color: #e0e0e0;
        }
        
        [data-theme="dark"] #dropdown-menu a:hover {
            background-color: #444;
            color: #64b5f6;
        }
        
        /* ç”¨æˆ·åæŒ‰é’®æ ·å¼ */
        .user-btn {
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        
        .user-btn:after {
            content: "â–¼";
            font-size: 0.7em;
            margin-left: 5px;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-container">
            <div class="navbar-menu">
                <a href="/" class="navbar-brand">EVE å·¥å…·é›†</a>
                <a href="/price_history" class="navbar-item">ä»·æ ¼æŸ¥è¯¢</a>
                <a href="/xuexi_ranshao" class="navbar-item">è¡€è¢­ç‡ƒçƒ§</a>
            </div>
            <div class="navbar-menu">
                <!-- EVE SSO è®¤è¯æŒ‰é’® -->
                {% if session.get('eve_character_name') %}
                    <span class="navbar-item user-btn" id="user-btn">{{ session.get('eve_character_name') }}</span>
                {% else %}
                    <a href="/auth/login" class="navbar-item">EVE SSO ç™»å½•</a>
                {% endif %}
                <!-- ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
                <button class="navbar-item theme-btn" onclick="toggleTheme()" title="åˆ‡æ¢å¤œé—´æ¨¡å¼">
                    <span id="theme-icon">ğŸŒ™</span>
                </button>
            </div>
        </div>
    </nav>
    
    <!-- å°†ä¸‹æ‹‰èœå•ç§»åˆ°bodyçš„ç›´æ¥å­å…ƒç´ ï¼Œå®Œå…¨è„±ç¦»å¯¼èˆªæ  -->
    {% if session.get('eve_character_name') %}
    <div id="dropdown-menu">
        <a href="/auth/logout">é€€å‡º</a>
    </div>
    {% endif %}

    <!-- åˆ é™¤è¿™é‡Œçš„æ‚¬æµ®çƒæŒ‰é’® -->
    <!-- <button class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢å¤œé—´æ¨¡å¼">
        <span id="theme-icon">ğŸŒ™</span>
    </button> -->

    <script>
        // å¤œé—´æ¨¡å¼åˆ‡æ¢åŠŸèƒ½
        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('theme-icon');
            const currentTheme = body.getAttribute('data-theme');
            
            if (currentTheme === 'dark') {
                body.removeAttribute('data-theme');
                themeIcon.textContent = 'ğŸŒ™';
                localStorage.setItem('theme', 'light');
            } else {
                body.setAttribute('data-theme', 'dark');
                themeIcon.textContent = 'â˜€ï¸';
                localStorage.setItem('theme', 'dark');
            }
        }

        // é¡µé¢åŠ è½½æ—¶åº”ç”¨ä¿å­˜çš„ä¸»é¢˜
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme');
            const themeIcon = document.getElementById('theme-icon');
            
            if (savedTheme === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
                themeIcon.textContent = 'â˜€ï¸';
            } else {
                themeIcon.textContent = 'ğŸŒ™';
            }
            
            // ä¸‹æ‹‰èœå•åŠŸèƒ½
            const userBtn = document.getElementById('user-btn');
            const dropdownMenu = document.getElementById('dropdown-menu');
            
            if (userBtn && dropdownMenu) {
                // ç‚¹å‡»ç”¨æˆ·åæŒ‰é’®æ—¶æ˜¾ç¤º/éšè—ä¸‹æ‹‰èœå•
                userBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    
                    // è·å–æŒ‰é’®ä½ç½®
                    const rect = userBtn.getBoundingClientRect();
                    
                    // è®¾ç½®ä¸‹æ‹‰èœå•ä½ç½®
                    dropdownMenu.style.top = (rect.bottom + window.scrollY) + 'px';
                    dropdownMenu.style.left = (rect.left + window.scrollX) + 'px';
                    dropdownMenu.style.display = dropdownMenu.style.display === 'block' ? 'none' : 'block';
                });
                
                // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­ä¸‹æ‹‰èœå•
                document.addEventListener('click', function() {
                    dropdownMenu.style.display = 'none';
                });
            }
        });
    </script>
</body>
</html>